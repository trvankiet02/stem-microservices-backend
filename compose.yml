version: "3.7"
networks:
  stem-microservices-backend: {}
volumes:
  mongodb: {}
  cloud-config: {}

services:
#  mongodb:
#    container_name: mongodb
#    image: mongo:latest
#    ports:
#      - "27017:27017"
#    volumes:
#      - mongodb:/data
#    environment:
#      - MONGO_INITDB_ROOT_USERNAME=admin
#      - MONGO_INITDB_ROOT_PASSWORD=123456
#    networks:
#      - stem-microservices-backend
#
#  mongo-express:
#    container_name: mongo-express
#    image: mongo-express:latest
#    ports:
#      - "8081:8081"
#    environment:
#      - ME_CONFIG_MONGODB_ADMINUSERNAME=admin
#      - ME_CONFIG_MONGODB_ADMINPASSWORD=123456
#      - ME_CONFIG_MONGODB_SERVER=mongodb
#    networks:
#      - stem-microservices-backend
#    depends_on:
#      - mongodb

  cloud-config:
    container_name: cloud-config
    image: trvankiet02/cloud-config:1.0-SNAPSHOT
    ports:
      - "8888:8888"
    networks:
      - stem-microservices-backend
    volumes:
      - cloud-config:/data
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://cloud-config:8888/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 5

  service-discovery:
    container_name: service-discovery
    image: trvankiet02/service-discovery:1.0-SNAPSHOT
    ports:
      - "8761:8761"
    networks:
      - stem-microservices-backend
    depends_on:
      - cloud-config
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://service-discovery:8761/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 5

  conversation-service:
    container_name: conversation-service
    image: trvankiet02/conversation-service:1.0-SNAPSHOT
    ports:
      - "8100:8100"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  friend-service:
    container_name: friend-service
    image: trvankiet02/friend-service:1.0-SNAPSHOT
    ports:
      - "8200:8200"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  group-service:
    container_name: group-service
    image: trvankiet02/group-service:1.0-SNAPSHOT
    ports:
      - "8300:8300"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://group-service:8300/actuator/health" ]
      interval: 30s
      timeout: 10s
      retries: 5

  media-service:
    container_name: media-service
    image: trvankiet02/media-service:1.0-SNAPSHOT
    ports:
      - "8400:8400"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  message-service:
    container_name: message-service
    image: trvankiet02/message-service:1.0-SNAPSHOT
    ports:
      - "8500:8500"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  notification-service:
    container_name: notification-service
    image: trvankiet02/notification-service:1.0-SNAPSHOT
    ports:
      - "8600:8600"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  post-service:
    container_name: post-service
    image: trvankiet02/post-service:1.0-SNAPSHOT
    ports:
      - "8700:8700"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  user-service:
    container_name: user-service
    image: trvankiet02/user-service:1.0-SNAPSHOT
    ports:
      - "8000:8000"
    networks:
      - stem-microservices-backend
    depends_on:
      - service-discovery
      - cloud-config

  api-gateway:
    container_name: api-gateway
    image: trvankiet02/api-gateway:1.0-SNAPSHOT
    ports:
      - "8080:8080"
    networks:
      - stem-microservices-backend
    depends_on:
      - cloud-config
      - service-discovery